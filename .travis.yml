sudo: false
language: c

dist: xenial

matrix:
  fast_finish: true

  include:
       - os: linux
      env:
        - NIM_COMPILE_TO_CPP=false
        - CPU=i386
      addons:
        apt:
          packages:
            - gcc-multilib
            - g++-multilib
            - libcurl4-openssl-dev:i386
            - libgc-dev:i386
            - libglib2.0-dev:i386
            - libpulse-dev:i386
            - libsdl1.2-dev:i386
            - libsfml-dev:i386


addons:
  apt:
    # update the list above if more deps are introduced
    packages:
    - libcurl4-openssl-dev
    - libsdl1.2-dev
    - libgc-dev
    - libsfml-dev
    - libc6-dbg
    - valgrind

install:
  - if [[ $CPU = i386 ]]; then echo -e "#!/bin/bash\n$(which gcc) -m32 \"\$@\"" > bin/gcc; fi
  - if [[ $CPU = i386 ]]; then chmod 755 bin/gcc; fi
  - if [[ $CPU = i386 ]]; then echo -e "#!/bin/bash\n$(which g++) -m32 \"\$@\"" > bin/g++; fi
  - if [[ $CPU = i386 ]]; then chmod 755 bin/g++; fi


before_script:
  - git clone --depth 1 https://github.com/nim-lang/csources.git
  - export PATH="$PWD/bin${PATH:+:$PATH}"
  - make -C csources -j 2 LD=$CC ucpu=$CPU

script:
  - git clone https://github.com/Adeohluwa/gen.git && cd gen
  - nimble install